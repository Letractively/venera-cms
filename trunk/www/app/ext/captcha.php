<?php@session_start();srand(microtime()*123456789);$code.=''.rand(0,9).rand(1,9).rand(1,9).rand(1,9).rand(1,9);$_SESSION['captcha_code']=md5($code);$im2 = @imagecreate (100, 30) or die ("Cannot initialize new GD image stream!");$bg = imagecolorallocate ($im2, 255, 255, 255);imagefill($im2, 0, 0, $bg);$color = imagecolorallocate ($im2, 0, 0, 0); $im= @imagecreate (220, 100) or die ("Cannot initialize new GD image stream!");$bg = imagecolorallocate ($im, 255, 255, 255);imagefill($im, 0, 0, $bg);//создаём шум на фоне//выводим символы кодаimagestring($im2, 3, 5, 3, $code, $color);for($i=0;$i<101;$i++){		srand(microtime()*123567);		$color=imagecolorallocate($im, rand(200,255), rand(200,255), rand(200,255));		imageellipse($im,$i*2,rand(0,100),rand(1,200),rand(1,200),$color);	}for($x=0;$x<101;$x++){	for($y=0;$y<31;$y++){			$rgb = imagecolorat($im2, $x, $y);			$rgb= imagecolorsforindex($im2, $rgb);			if($rgb['red']==0){ 				$color=imagecolorallocate($im, rand(50,200), rand(50,200), rand(50,200));				imageellipse($im,$x*5,$y*5,rand(3,7),rand(3,7),$color);				imageellipse($im,$x*5,$y*5,2,2,$color);			}		}}/*/упрощённый вариант$color = imagecolorallocate($img, 0, 0, 0);imagestring($im, 3, 5, 3, $char, $color);*///антикешированиеheader("Expires: Mon, 26 Jul 1997 05:00:00 GMT");header("Cache-Control: no-store, no-cache, must-revalidate");header("Cache-Control: post-check=0, pre-check=0", false);header("Pragma: no-cache");//создание рисунка в зависимости от доступного форматаif (function_exists("imagepng")) {		   header("Content-type: image/png");		   imagepng($im);} elseif (function_exists("imagegif")) {		   header("Content-type: image/gif");		   imagegif($im);} elseif (function_exists("imagejpeg")) {		   header("Content-type: image/jpeg");		   imagejpeg($im);} else {		   die("No image support in this PHP server!");}imagedestroy ($im);?>